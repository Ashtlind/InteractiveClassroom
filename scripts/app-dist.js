
;$(document).ready(function(){$("#StudentCount").keypress(function(e){"13"==e.keyCode&&e.preventDefault()})});var app=angular.module("IC",["firebase","ngAnimate","ngRoute"]);app.factory("Auth",["$firebaseAuth",function($firebaseAuth){var ref=new Firebase("https://interactiveclassroom.firebaseio.com");return $firebaseAuth(ref)}]),app.directive("myEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.myEnter)}),event.preventDefault())})}});
angular.module("IC").run(["$rootScope","$location",function($rootScope,$location){$rootScope.$on("$routeChangeError",function(event,next,previous,error){"AUTH_REQUIRED"===error&&$location.path("/")})}]),angular.module("IC").config(["$routeProvider",function($routeProvider){$routeProvider.when("/class:classid",{controller:"Student",templateUrl:"student.html",resolve:{currentAuth:["Auth",function(Auth){return Auth.$requireAuth()}]}}).when("/dashboard:classid",{controller:"Teacher",templateUrl:"teacher.html",resolve:{currentAuth:["Auth",function(Auth){return Auth.$requireAuth()}]}}).when("/",{templateUrl:"home.html",controller:"Home"}).otherwise({redirectTo:"/"})}]);
angular.module("IC").controller("Home",["$scope","$firebaseObject","$firebaseArray","$timeout","$location",function($scope,$firebaseObject,$firebaseArray,Auth,$timeout,$location){var root=new Firebase("https://interactiveclassroom.firebaseio.com");$rootScope.$broadcast("userGuidReq","Home"),$scope.$on("userGuidHome",function(event,guid){void 0==guid||null==guid?$scope.userData={}:$scope.userData=$firebaseObject(root.child("Users").child(guid))}),$scope.btngrpclass="",$scope.invitecode="",$scope.labeltext="",$scope.addingClass=!1,$scope.cancel=function(){$scope.btngrpclass="",$scope.invitecode="",$scope.addingClass=!1},$scope.$on("authed",function(event,success){success?($rootScope.$broadcast("userGuidReq","Home"),$scope.btngrpclass="homebtngrp--loggedin",$scope.invitecode="Welcome "+userData.name.split(" ")[0]+"!",$timeout(function(){$scope.invitecode="",$scope.labeltext=$scope.labelText(addnew),$scope.btngrpclass="homebtngrp--invitecode",setTimeout(function(){$(".homebtngrp-left-input").focus()},500)},2e3)):$scope.cancel()}),$scope.classroom=function(addnew){$scope.addingClass=addnew,void 0==$scope.userData.uid?($scope.btngrpclass="homebtngrp--login",$rootScope.$broadcast("login")):($scope.labeltext=$scope.labelText(),$scope.btngrpclass="homebtngrp--invitecode",setTimeout(function(){$(".homebtngrp-left-input").focus()},500))},$scope.labelText=function(){return $scope.addingClass?"Name your new class.":"Please enter your invite code."},$scope.secondary=function(){switch($scope.btngrpclass){case"homebtngrp--login":$scope.login();break;case"homebtngrp--loggedin":break;case"homebtngrp--invitecode":$scope.addingClass?$scope.createClass():$scope.joinClass();break;default:$scope.classroom(!0)}},$scope.createClass=function(){var classes=$firebaseArray(root.child("Classes"));classes.$add({Pub:{CurrentLesson:null,CurrentTopic:null,Name:$scope.invitecode,Teacher:$scope.userData.uid},Lessons:null}).then(function(newRef){var user=$firebaseObject(root.child("Users").child($scope.userData.uid).child("Teaches").child(newRef.key()));user.$loaded(function(){null==user.$value&&(user.$value=Date(),user.$save()),$location.path("/dashboard:"+newRef.key())})})},$scope.joinClass=function(){if(""!=$scope.invitecode&&$scope.invitecode.length>3){var joiner=$firebaseObject(root.child("Joiners").child($scope.invitecode));joiner.$loaded(function(){if(null!=joiner&&void 0!=joiner){var user=$firebaseObject(root.child("Users").child($scope.userData.uid));user.$loaded(function(){void 0==user.Partakes&&(user.Partakes={}),void 0==user.Partakes[joiner.Class]&&(user.Partakes[joiner.Class]=Date(),user.$save()),void 0!=user.Teaches&&void 0!=user.Teaches[joiner.Class]?$location.path("/dashboard:"+joiner.Class):$location.path("/class:"+joiner.Class)})}})}}}]);
angular.module("IC").controller("Student",["$scope","$firebaseObject","$firebaseArray","$routeParams","$interval",function($scope,$firebaseObject,$firebaseArray,$routeParams,$interval){var root=new Firebase("https://interactiveclassroom.firebaseio.com");$scope.classid=$routeParams.classid.substring(1),$rootScope.$broadcast("userGuidReq","Student"),$scope.$on("userGuidStudent",function(event,guid){void 0==guid||null==guid?$scope.userData={}:$scope.userData=$firebaseObject(root.child("Users").child(guid))});var classRef=root.child("Classes").child($scope.classid),classInfoRef=classRef.child("/Pub");$scope.classInfo=$firebaseObject(classInfoRef),$scope.currentAnswer={};var heartbeatIntervalPromise={};$scope.classInfo.$loaded(function(){var lessonRef=classRef.child("Lessons").child($scope.classInfo.CurrentLesson),lessonHBRef=lessonRef.child("Students").child(authData.uid);$scope.myHeartbeat=$firebaseObject(lessonHBRef),$scope.myHeartbeat.$value=Date(),$scope.myHeartbeat.$save(),heartbeatIntervalPromise=$interval(function(){$scope.myHeartbeat.$value=Date(),$scope.myHeartbeat.$save()},3e4);var topicAnswer=lessonRef.child("Topics").child($scope.classInfo.CurrentTopic).child("Answers").child(authData.uid);$scope.currentAnswer=$firebaseObject(topicAnswer)}),$scope.$on("$destroy",function(){$interval.cancel(heartbeatIntervalPromise)}),$scope.answer=function(answer){$scope.currentAnswer.Answer=answer,$scope.currentAnswer.Date=Date(),$scope.currentAnswer.$save()}}]);
angular.module("IC").controller("Teacher",["$scope","$firebaseObject","$firebaseArray","$routeParams",function($scope,$firebaseObject,$firebaseArray,$routeParams){var root=new Firebase("https://interactiveclassroom.firebaseio.com");$scope.classid=$routeParams.classid.substring(1),$rootScope.$broadcast("userGuidReq","Teacher"),$scope.$on("userGuidTeacher",function(event,guid){void 0==guid||null==guid?$scope.userData={}:$scope.userData=$firebaseObject(root.child("Users").child(guid))});var classRef=new Firebase("https://interactiveclassroom.firebaseio.com/Classes/"+$scope.classid),classInfoRef=classRef.child("/Pub");$scope.classInfo=$firebaseObject(classInfoRef);var lampsRef=new Firebase("https://huehue.firebaseio.com/Hue/Lamps");$scope.Lamps=$firebaseObject(lampsRef),$scope.Lamps.$loaded(function(){}),$scope.Lesson={},$scope.Topic={},$scope.$watch("classInfo",function(newVal,oldVal){void 0!=newVal.CurrentLesson&&newVal.CurrentLesson!=oldVal.CurrentLesson&&($scope.Lesson=$firebaseObject(classInfoRef.child("Lessons").child(newVal.CurrentLesson))),void 0!=newVal.CurrentTopic&&newVal.CurrentTopic!=oldVal.CurrentTopic&&($scope.Lesson=$firebaseObject(classInfoRef.child("Lessons").child(newVal.CurrentLesson).child("Topics").child(newVal.CurrentTopic)))}),$scope.pluralsAreGoodIGuess=function(numb){return numb>1?"s":void 0},$scope.$watch("lampSel",function(newVal){console.log(newVal),angular.forEach($scope.Lamps,function(lamp,key){newVal==lamp&&($scope.Settings.Lamp=key,$scope.Settings.$save())})}),$scope.createNewLesson=function(){var newLessonRef=new Firebase($scope.fbRefClass+"/Lessons"),theNewLesson=({Date:Date(),Students:null},newLessonRef.push(les)),newSessionRef=new Firebase(theNewLesson.toString()+"/Sessions"),sesh={Date:Date(),StudentCount:$scope.stuCount,TrueCount:0,FalseCount:0},theNewSession=newSessionRef.push(sesh);$scope.Settings.CurrentLesson=theNewLesson.key(),$scope.Settings.CurrentSession=theNewSession.key(),$scope.Settings.$save()},$scope.createNewSession=function(){var newSessionRef=new Firebase($scope.fbRefClass+"/Lessons/"+$scope.Settings.CurrentLesson+"/Sessions"),sesh={Date:Date(),StudentCount:$scope.stuCount,TrueCount:0,FalseCount:0},theNewSession=newSessionRef.push(sesh);$scope.Settings.CurrentSession=theNewSession.key(),$scope.Settings.$save()},$scope.finishLesson=function(){$scope.Settings.CurrentSession="",$scope.Settings.CurrentLesson="",$scope.Settings.$save(),$scope.CurrentSession={}},$scope.editc=!1,$scope.colors=new Array,$scope.avalicolors=["Violet","RoyalBlue","LightSkyBlue","Aqua","AquaMarine","Green","LimeGreen","Yellow","Goldenrod","Orange","Red","Pink","Fuchsia","Orchid","Lavender"],$scope.colors.push({perc:"0%"}),$scope.colors.push({color:"Violet",perc:"40%"}),$scope.colors.push({color:"RoyalBlue",perc:"50%"}),$scope.colors.push({color:"LightSkyBlue",perc:"70%"}),$scope.colors.push({color:"AquaMarine",perc:"100%"}),$scope.colorPercDiff=function(color){var indx=$scope.colors.indexOf(color)-1,st=parseInt($scope.colors[indx].perc.substring(0,color.perc.length-1)),en=parseInt(color.perc.substring(0,color.perc.length-1));return en-st+"%"},$scope.findColor=function(perc){var ret="bgc-gray",lastperc=0;return angular.forEach($scope.colors,function(col){var en=parseInt(col.perc.substring(0,col.perc.length-1));perc>=lastperc&&en>perc&&(ret="bglc-"+col.color),lastperc=en}),ret}}]);
angular.module("IC").controller("Nav",["$scope","$firebaseObject","$firebaseArray","Auth","$timeout","$location","$rootScope",function($scope,$firebaseObject,$firebaseArray,Auth,$timeout,$location,$rootScope){var root=new Firebase("https://interactiveclassroom.firebaseio.com");$scope.userData={},Auth.$onAuth(function(authData){$scope.userData=$firebaseObject(root.child("Users").child(authData.uid)),$scope.userData.$loaded(function(){$scope.userData.uid=authData.uid,$scope.userData.email=authData.google.email,$scope.userData.name=authData.google.displayName,$scope.userData.profileImageURL=authData.google.profileImageURL,$scope.userData.LastLogin=Date(),userData.$save().then(function(){$rootScope.$broadcast("userGuidHome",$scope.userData)})})}),$scope.$on("userGuidReq",function(event,sender){$rootScope.$broadcast("userGuid"+sender,$scope.userData)}),$scope.$on("login",function(){Auth.$authWithOAuthPopup("google",{scope:"email"}).then(function(){})["catch"](function(error){"TRANSPORT_UNAVAILABLE"===error.code?Auth.$authWithOAuthRedirect(authMethod).then(function(){}):$rootScope.$broadcast("authed",!1,$scope.userData)})}),$scope.userData=={}&&Auth.$getAuth(),$scope.nav=!1,$scope.navitems=new Array,$scope.items=[],$scope.$watch("userData.Partakes",function(newVal){void 0!=newVal&&null!=newVal&&angular.forEach(newVal,function(partake,key){var className=$firebaseObject(root.child("Classes").child(key).child("Pub").child("Name"));className.$loaded(function(){$scope.navitems.push({name:"S - "+className.$value,link:"class:"+key})})})}),$scope.$watch("userData.Teaches",function(newVal){void 0!=newVal&&null!=newVal&&angular.forEach(newVal,function(teach,key){var className=$firebaseObject(root.child("Classes").child(key).child("Pub").child("Name"));className.$loaded(function(){$scope.navitems.push({name:"T - "+className.$value,link:"dashboard:"+key})})})}),$scope.toggle=function(){$scope.nav?$scope.items=[]:$scope.items=$scope.navitems,$scope.nav=!$scope.nav}}]);
