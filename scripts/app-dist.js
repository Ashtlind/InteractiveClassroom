
;$(document).ready(function(){$("#StudentCount").keypress(function(e){"13"==e.keyCode&&e.preventDefault()})});var app=angular.module("IC",["firebase","ngAnimate","ngRoute"]);app.factory("Auth",["$firebaseAuth",function($firebaseAuth){var ref=new Firebase("https://interactiveclassroom.firebaseio.com");return $firebaseAuth(ref)}]);
angular.module("IC").run(["$rootScope","$location",function($rootScope,$location){$rootScope.$on("$routeChangeError",function(event,next,previous,error){"AUTH_REQUIRED"===error&&$location.path("/:login")})}]),angular.module("IC").config(["$routeProvider",function($routeProvider){$routeProvider.when("/student",{controller:"Student",templateUrl:"student.html",resolve:{currentAuth:["Auth",function(Auth){return Auth.$requireAuth()}]}}).when("/teacher",{controller:"Teacher",templateUrl:"teacher.html",resolve:{currentAuth:["Auth",function(Auth){return Auth.$requireAuth()}]}}).when("/",{templateUrl:"home.html",controller:"Student"})}]);
angular.module("IC").controller("Home",["$scope","$firebaseObject","$firebaseArray","Auth",function($scope,$firebaseObject,$firebaseArray,Auth){$scope.login=function(){Auth.$authWithOAuthPopup("google").then(function(){})["catch"](function(error){"TRANSPORT_UNAVAILABLE"===error.code?Auth.$authWithOAuthPopup(authMethod).then(function(){}):console.log(error)})}}]);
angular.module("IC").controller("Student",["$scope","$firebaseObject","$firebaseArray",function($scope,$firebaseObject){console.log("loaded!"),$scope.clas="MAT0813_23C",$scope.fbRefClass="https://interactiveclassroom.firebaseio.com/Classes/"+$scope.clas;var settingsRef=new Firebase($scope.fbRefClass+"/Settings");$scope.Settings=$firebaseObject(settingsRef),$scope.answer=function(ans){if(""!=$scope.Settings.CurrentLesson&&""!=$scope.Settings.CurrentSession){var answersRef=new Firebase($scope.fbRefClass+"/Lessons/"+$scope.Settings.CurrentLesson+"/Sessions/"+$scope.Settings.CurrentSession+"/Answers/"+$scope.tempuserid),current=$firebaseObject(answersRef);current.$loaded(function(){var changing=void 0!=current.Answer;if(current.Answer!=ans){answersRef.set({Answer:ans,Date:Date()});var sessionTrue=new Firebase($scope.fbRefClass+"/Lessons/"+$scope.Settings.CurrentLesson+"/Sessions/"+$scope.Settings.CurrentSession+"/TrueCount"),sessionFalse=new Firebase($scope.fbRefClass+"/Lessons/"+$scope.Settings.CurrentLesson+"/Sessions/"+$scope.Settings.CurrentSession+"/FalseCount");ans?(sessionTrue.transaction(function(current_value){return(current_value||0)+1}),changing&&sessionFalse.transaction(function(current_value){return(current_value||0)-1})):(sessionFalse.transaction(function(current_value){return(current_value||0)+1}),changing&&sessionTrue.transaction(function(current_value){return(current_value||0)-1}))}})}}}]);
angular.module("IC").controller("Teacher",["$scope","$firebaseObject","$firebaseArray",function($scope,$firebaseObject){$scope.clas="MAT0813_23C",$scope.fbRefClass="https://huehue.firebaseio.com/Classes/"+$scope.clas,$scope.stuCount=24,$scope.lampSel={},$scope.CurrentSession={};var settingsRef=new Firebase($scope.fbRefClass+"/Settings");$scope.Settings=$firebaseObject(settingsRef);var lampsRef=new Firebase("https://huehue.firebaseio.com/Hue/Lamps");$scope.Lamps=$firebaseObject(lampsRef),$scope.Lamps.$loaded(function(){}),$scope.Settings.$loaded(function(){void 0==$scope.Settings.CurrentSession&&($scope.Settings.CurrentLesson=""),""!=$scope.Settings.CurrentLesson&&void 0!=$scope.Settings.CurrentLesson&&void 0!=$scope.Settings.Lamp&&(angular.forEach($scope.Lamps,function(lamp,key){key==$scope.Settings.Lamp&&($scope.lampSel=lamp)}),console.log($scope.lampSel))}),$scope.$watch("Settings.CurrentSession",function(newVal){if(""!=newVal&&void 0!=newVal){console.log("NEW Session!");var sessionRef=new Firebase($scope.fbRefClass+"/Lessons/"+$scope.Settings.CurrentLesson+"/Sessions/"+$scope.Settings.CurrentSession);$scope.CurrentSession=$firebaseObject(sessionRef),$scope.CurrentSession.$loaded(function(){console.log($scope.CurrentSession),void 0!=$scope.CurrentSession.StudentCount?$scope.stuCount=$scope.CurrentSession.StudentCount:$scope.stuCount=24})}}),$scope.pluralsAreGoodIGuess=function(numb){return numb>1?"s":void 0},$scope.$watch("lampSel",function(newVal){console.log(newVal),angular.forEach($scope.Lamps,function(lamp,key){newVal==lamp&&($scope.Settings.Lamp=key,$scope.Settings.$save())})}),$scope.stuCountChange=function(keyEvent){if(13===keyEvent.which&&$scope.stuCount>0){var lessonRef=new Firebase($scope.fbRefClass+"/Lessons/"+$scope.Settings.CurrentLesson),sessionRef=new Firebase($scope.fbRefClass+"/Lessons/"+$scope.Settings.CurrentLesson+"/Sessions/"+$scope.Settings.CurrentSession);lessonRef.update({StudentCount:$scope.stuCount}),sessionRef.update({StudentCount:$scope.stuCount})}},$scope.createNewLesson=function(){var newLessonRef=new Firebase($scope.fbRefClass+"/Lessons"),les={Date:Date(),StudentCount:$scope.stuCount},theNewLesson=newLessonRef.push(les),newSessionRef=new Firebase(theNewLesson.toString()+"/Sessions"),sesh={Date:Date(),StudentCount:$scope.stuCount,TrueCount:0,FalseCount:0},theNewSession=newSessionRef.push(sesh);$scope.Settings.CurrentLesson=theNewLesson.key(),$scope.Settings.CurrentSession=theNewSession.key(),$scope.Settings.$save()},$scope.createNewSession=function(){var newSessionRef=new Firebase($scope.fbRefClass+"/Lessons/"+$scope.Settings.CurrentLesson+"/Sessions"),sesh={Date:Date(),StudentCount:$scope.stuCount,TrueCount:0,FalseCount:0},theNewSession=newSessionRef.push(sesh);$scope.Settings.CurrentSession=theNewSession.key(),$scope.Settings.$save()},$scope.finishLesson=function(){$scope.Settings.CurrentSession="",$scope.Settings.CurrentLesson="",$scope.Settings.$save(),$scope.CurrentSession={}},$scope.editc=!1,$scope.colors=new Array,$scope.avalicolors=["Violet","RoyalBlue","LightSkyBlue","Aqua","AquaMarine","Green","LimeGreen","Yellow","Goldenrod","Orange","Red","Pink","Fuchsia","Orchid","Lavender"],$scope.colors.push({perc:"0%"}),$scope.colors.push({color:"Violet",perc:"40%"}),$scope.colors.push({color:"RoyalBlue",perc:"50%"}),$scope.colors.push({color:"LightSkyBlue",perc:"70%"}),$scope.colors.push({color:"AquaMarine",perc:"100%"}),$scope.colorPercDiff=function(color){var indx=$scope.colors.indexOf(color)-1,st=parseInt($scope.colors[indx].perc.substring(0,color.perc.length-1)),en=parseInt(color.perc.substring(0,color.perc.length-1));return en-st+"%"},$scope.findColor=function(perc){var ret="bgc-gray",lastperc=0;return angular.forEach($scope.colors,function(col){var en=parseInt(col.perc.substring(0,col.perc.length-1));perc>=lastperc&&en>perc&&(ret="bglc-"+col.color),lastperc=en}),ret}}]);
