$(document).ready(function(){$("#StudentCount").keypress(function(e){"13"==e.keyCode&&e.preventDefault()})});var app=angular.module("IC",["firebase","ngAnimate","ngRoute","angular-loading-bar","hue","angularResizable","ngDragDrop"]),config={apiKey:"AIzaSyBpdRvCW0oJH5ukKNWBZp3jipGVg8w0wyE",authDomain:"interactiveclassroom.firebaseapp.com",databaseURL:"https://interactiveclassroom.firebaseio.com",storageBucket:"project-3354574417935505015.appspot.com"};firebase.initializeApp(config),app.factory("fbRef",[function(){var e=firebase.database().ref();return e}]),app.factory("Auth",["$firebaseAuth",function(e){return e()}]),app.directive("myEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.myEnter)}),t.preventDefault())})}}),app.directive("myResize",["$window",function(e){return function(t,n,r){angular.element(e).bind("resize",function(){t.$apply(function(){t.$eval(r.gothing)})})}}]),angular.module("IC").run(["$rootScope","$location",function(e,t){e.$on("$routeChangeError",function(e,n,r,o){"AUTH_REQUIRED"===o&&t.path("/")})}]),angular.module("IC").config(["$routeProvider",function(e){e.when("/class:classid",{controller:"Student",templateUrl:"/views/student.html",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]}}).when("/dashboard:classid",{controller:"Teacher",templateUrl:"/views/teacher.html",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]}}).when("/",{templateUrl:"/views/home.html",controller:"Home"}).when("/:action",{templateUrl:"/views/home.html",controller:"Home"}).otherwise({redirectTo:"/"})}]),angular.module("IC").controller("Home",["$scope","$firebaseObject","$firebaseArray","$timeout","$location","$rootScope","$routeParams","cfpLoadingBar","fbRef",function(e,t,n,r,o,s,u,i,a){var c=a;if(void 0!=u.action){var l=u.action.substring(1);switch(l){case"logout":s.$broadcast("logout")}}e.btngrpclass="",e.invitecode="",e.labeltext="",e.addingClass=!1,e.joinBtn=!1,e.cancel=function(){e.btngrpclass="",e.invitecode="",e.addingClass=!1,e.joinBtn=!1},e.userData={},i.start(),e.$on("userGuid",function(n,o){void 0==o||null==o?(e.userData={},e.cancel(),i.complete()):(e.userData=t(c.child("Users").child(o).child("User")),e.userData.$loaded(function(){e.joinBtn?(e.btngrpclass="homebtngrp--loggedin",e.invitecode="Welcome "+e.userData.name.split(" ")[0]+"!",r(function(){e.invitecode="",e.labeltext=e.labelText(),e.btngrpclass="homebtngrp--invitecode",setTimeout(function(){$(".homebtngrp-left-input").focus()},500)},2e3)):e.cancel(),i.complete()}))}),s.$broadcast("userGuidReq"),e.classroom=function(t){e.addingClass=t,void 0==e.userData.uid?(e.btngrpclass="homebtngrp--login",e.joinBtn=!0,s.$broadcast("login")):(e.labeltext=e.labelText(),e.btngrpclass="homebtngrp--invitecode",setTimeout(function(){$(".homebtngrp-left-input").focus()},500))},e.labelText=function(){return e.addingClass?"Name your new class.":"Please enter your invite code."},e.secondary=function(){switch(e.btngrpclass){case"homebtngrp--login":s.$broadcast("login");break;case"homebtngrp--loggedin":break;case"homebtngrp--invitecode":e.addingClass?e.createClass():e.joinClass();break;default:e.classroom(!0)}},e.createClass=function(){var t=n(c.child("Classes"));t.$add({Pub:{CurrentLesson:null,CurrentTopic:null,Name:e.invitecode,Teacher:e.userData.uid},Lessons:null}).then(function(t){void 0==e.userData.Teaches[t.key()]&&null!=e.userData.Teaches[t.key()]&&(e.userData.Teaches[t.key()]=Date(),e.userData.$save()),o.path("/dashboard:"+t.key())})},e.joinClass=function(){if(""!=e.invitecode&&e.invitecode.length>3){var n=t(c.child("Joiners").child(e.invitecode));n.$loaded(function(){null!=n&&void 0!=n&&(void 0==e.userData.Partakes&&(e.userData.Partakes={}),void 0==e.userData.Partakes[n.Class]&&(e.userData.Partakes[n.Class]=Date(),e.userData.$save()),void 0!=e.userData.Teaches&&void 0!=e.userData.Teaches[n.Class]?o.path("/dashboard:"+n.Class):o.path("/class:"+n.Class))})}}}]),angular.module("IC").controller("Student",["$scope","$firebaseObject","$firebaseArray","$routeParams","$interval","$rootScope","cfpLoadingBar","fbRef",function(e,t,n,r,o,s,u,i){var a=i;e.classid=r.classid.substring(1),e.classInfo=t(a.child("Classes").child(e.classid).child("/Pub")),e.currentAnswer={};var c={};u.start(),e.$on("userGuid",function(n,r){void 0==r||null==r?e.userData={}:e.classInfo.$loaded(function(){var n=a.child("Classes").child(e.classid).child("Lessons").child(e.classInfo.CurrentLesson);e.userData=t(a.child("Users").child(r).child("User")),e.userData.$loaded(function(){e.myHeartbeat=t(n.child("Students").child(e.userData.uid)),e.myHeartbeat.$value=Date.now(),e.myHeartbeat.$save(),c=o(function(){e.myHeartbeat.$value=Date.now(),e.myHeartbeat.$save()},3e4),e.currentAnswer=t(n.child("Topics").child(e.classInfo.CurrentTopic).child("Answers").child(e.userData.uid)),u.complete()})})}),s.$broadcast("userGuidReq"),e.$on("$destroy",function(){o.cancel(c)}),e.answer=function(t){e.currentAnswer.Answer=t,e.currentAnswer.Date=Date(),e.currentAnswer.$save()}}]),angular.module("IC").controller("Teacher",["$scope","$firebaseObject","$firebaseArray","$routeParams","$rootScope","hue","fbRef",function(e,t,n,r,o,s,u){var i=u;e.classid=r.classid.substring(1);var a=i.child("Classes").child(e.classid),c=s;c.setup({username:"SzDOKancs7zL7Vubik2dn3MAqJJ8QU46iRZa7qpB",bridgeIP:"172.16.11.40",debug:!0}),c.getLights().then(function(t){e.lights=t,console.log(t),c.setLightState(1,{on:!0}).then(function(e){console.log("API response: ",e)})}),e.convertRGBtoXY=function(e,t,n){e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var r=.664511*e+.154324*t+.162028*n,o=.283881*e+.668433*t+.047685*n,s=88e-6*e+.07231*t+.986039*n,u=r/(r+o+s),i=o/(r+o+s);return isNaN(u)&&(u=0),isNaN(i)&&(i=0),[u,i]},e.testthethings=function(t,n,r){c.getLights().then(function(o){e.lights=o;var s=e.convertRGBtoXY(t,n,r);c.setLightState(1,{on:!0,xy:s,transitiontime:0}).then(function(e){console.log("API response: ",e)})})},o.$broadcast("userGuidReq"),e.$on("userGuid",function(n,r){void 0==r||null==r?e.userData={}:(e.userData=t(i.child("Users").child(r).child("User")),e.classPub=t(a.child("/Pub")))}),e.$watch("classPub",function(r,o){void 0!=r&&void 0!=r.CurrentLesson?((void 0==o||r.CurrentLesson!=o.CurrentLesson)&&(e.Students.List=n(a.child("Lessons").child(r.CurrentLesson).child("Students")),e.Students.List.$watch(function(t){if(void 0!=e.Students&&void 0!=e.Students.List){var n=0;angular.forEach(e.Students.List,function(e){e.$value>=Date.now()-7e4&&(n+=1)}),e.Students.StudentTotal=n}})),(void 0==o||r.CurrentTopic!=o.CurrentTopic&&void 0!=r.CurrentTopic)&&(e.Topic=t(a.child("Lessons").child(r.CurrentLesson).child("Topics").child(r.CurrentTopic)),console.log(e.Topic),e.Topic.$loaded(function(){console.log(e.Topic)}))):(e.Students={},e.Topic={})}),e.$watch("Topic.Answers",function(t,n){void 0!=t?(e.Answers.Total=0,e.Answers.zero=0,e.Answers.one=0,e.Answers.two=0,angular.forEach(t,function(t){e.Answers.Total+=1,t.Answer<1?e.Answers.zero+=1:t.Answer<2?e.Answers.one+=1:t.Answer<3&&(e.Answers.two+=1)}),console.log(e.Answers)):e.Answers={}}),e.pluralsAreGoodIGuess=function(e){return e>1?"s":void 0},e.$watch("lampSel",function(t){angular.forEach(e.Lamps,function(n,r){t==n&&(e.Settings.Lamp=r,e.Settings.$save())})}),e.createNewLesson=function(){var t=new Firebase(e.fbRefClass+"/Lessons"),n=({Date:Date(),Students:null},t.push(les)),r=new Firebase(n.toString()+"/Sessions"),o={Date:Date(),StudentCount:e.stuCount,TrueCount:0,FalseCount:0},s=r.push(o);e.Settings.CurrentLesson=n.key(),e.Settings.CurrentSession=s.key(),e.Settings.$save()},e.createNewSession=function(){var t=new Firebase(e.fbRefClass+"/Lessons/"+e.Settings.CurrentLesson+"/Sessions"),n={Date:Date(),StudentCount:e.stuCount,TrueCount:0,FalseCount:0},r=t.push(n);e.Settings.CurrentSession=r.key(),e.Settings.$save()},e.finishLesson=function(){e.Settings.CurrentSession="",e.Settings.CurrentLesson="",e.Settings.$save(),e.CurrentSession={}},e.colors=new Array,e.avalicolors=["RoyalBlue","Aqua","Green","Yellow","Orange","Red","Fuchsia","Violet","Lavender","Transparent"],e.removeColor="REMOVE",e.colors.push({color:"Violet",perc:"10"}),e.colors.push({color:"RoyalBlue",perc:"50"}),e.colors.push({color:"Green",perc:"20"}),e.colors.push({color:"Aqua",perc:"20"}),e.draggingColor=!1,e.draggingColorStart=function(){e.$apply(function(){e.draggingColor=!0})},e.draggingColorStop=function(){e.$apply(function(){e.draggingColor=!1})},e.draggingColorRemove=!1,e.draggingColorRemoveStart=function(){e.$apply(function(){e.draggingColorRemove=!0})},e.draggingColorRemoveStop=function(){e.$apply(function(){e.draggingColorRemove=!1})},e.dropColorHoverOver=function(e){angular.element(e.target).addClass("colorbarcolorhover")},e.dropColorHoverOut=function(e){angular.element(e.target).removeClass("colorbarcolorhover")},e.colorbaradd={},e.droppedColor=function(t){angular.element(t.target).removeClass("colorbarcolorhover"),console.log(t),e.draggingColorRemove&&angular.forEach(e.colors,function(t,n){"REMOVE"==t.color&&e.colors.splice(n,1)}),e.colorbaradd!={}&&(void 0!=e.colorbaradd.left&&""!=e.colorbaradd.left&&e.colors.splice(0,0,{color:e.colorbaradd.left}),void 0!=e.colorbaradd.right&&""!=e.colorbaradd.right&&e.colors.push({color:e.colorbaradd.right}),e.colorbaradd={})},e.recalcColor=function(){var t=$(".colorbar").width(),n=0;angular.forEach(e.colors,function(e,r){var o=$("#color-"+r).outerWidth(!0)/t*100;n+=o,e.perc=o})},e.findColor=function(t){var n="bgc-gray",r=0;return angular.forEach(e.colors,function(o,s){if(t>=r&&r+o.perc>t){console.log("found one!"),n="bglc-"+o.color;var u=$("#color-"+s).css("color");console.log(u);var i=/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/,a=i.exec(u);null!==a&&(console.log("Red: "+a[1]+" Green: "+a[2]+" Blue: "+a[3]),e.testthethings(a[1],a[2],a[3]))}r+=o.perc}),n},e.findFlexBasis=function(){var t=$("#color-0").outerWidth()-$("#color-0").width();angular.forEach(e.colors,function(e,n){var r=$(".colorbar").width(),o=r*(e.perc/100)-t;$("#color-"+n).css("flexBasis",o)})}}]),angular.module("IC").controller("Nav",["$scope","$firebaseObject","$firebaseArray","Auth","$timeout","$location","$rootScope","fbRef",function(e,t,n,r,o,s,u,i){var a=i;u.userData={},r.$onAuthStateChanged(function(e){null!=e?(u.userData=t(a.child("Users").child(e.uid).child("User")),u.userData.$loaded(function(){u.userData.uid=e.uid,u.userData.email=e.providerData[0].email,u.userData.name=e.providerData[0].displayName,u.userData.profileImageURL=e.providerData[0].photoURL,u.userData.LastLogin=Date(),u.userData.$save().then(function(){u.$broadcast("userGuid",u.userData.uid)})}),u.classData=t(a.child("Users").child(e.uid).child("Classes"))):(u.userData={},u.$broadcast("userGuid",void 0))}),e.$on("userGuidReq",function(e){u.$broadcast("userGuid",u.userData.uid)}),e.$watch("userData.uid",function(e,t){void 0==e&&r.$getAuth(),console.log("watchauth: "+e)}),e.$on("login",function(){var e=new firebase.auth.GoogleAuthProvider;e.addScope("email"),e.addScope("profile"),r.$signInWithPopup(e).then(function(e){})["catch"](function(t){"TRANSPORT_UNAVAILABLE"===t.code?r.$signInWithRedirect(e).then(function(e){}):u.$broadcast("userGuidHome",null)})}),e.$on("logout",function(){r.$signOut(),u.userData={},s.path("/")}),e.nav=!1,e.showNav=function(){return void 0==u.userData.uid?!1:!0},e.navitemsdef=new Array({icon:"replay",link:"#/",fb:{Name:"Home"}},{icon:"highlight_off",link:"#/:logout",fb:{Name:"Log off"}}),e.navitems=new Array,e.navitemspartakes=new Array,e.navitemsteaches=new Array,e.itemsUpdate=function(){var t=[e.navitemspartakes,e.navitemsteaches,e.navitemsdef];e.navitems=[],angular.forEach(t,function(t){angular.forEach(t,function(t){e.navitems.push(t)})}),e.nav&&(e.items=e.navitems)},e.$watch("classData.Partakes",function(n,r){e.navitemspartakes=new Array,void 0!=n&&null!=n?angular.forEach(n,function(n,r){var o=t(a.child("Classes").child(r).child("Pub"));o.$loaded(function(){var t=!1;""!=o.CurrentLesson&&(t=!0),e.navitemspartakes.push({icon:"face",link:"#/class:"+r,active:t,fb:o}),e.itemsUpdate()})}):e.itemsUpdate()}),e.$watch("classData.Teaches",function(n,r){e.navitemsteaches=new Array,void 0!=n&&null!=n?angular.forEach(n,function(n,r){var o=t(a.child("Classes").child(r).child("Pub"));o.$loaded(function(){var t=!1;""!=o.CurrentLesson&&(t=!0),e.navitemsteaches.push({icon:"stars",link:"#/dashboard:"+r,active:t,fb:o}),e.itemsUpdate()})}):e.itemsUpdate()}),e.toggle=function(){e.items=new Array,e.nav||(e.items=e.navitems),e.nav=!e.nav}}]),angular.module("hue",[]).service("hue",["$http","$q","$log",function(e,t,n){var r,o,s,u,i,a,c,l,d,h,f,g;o={username:"",apiUrl:"",bridgeIP:""},u=!1,g=function(){var e;return e=t.defer(),u?(e.resolve(),e.promise):""===o.username?(n.error("Error in setup: Username has to be set"),e.reject,e.promise):""!==o.apiUrl?(u=!0,e.resolve(),e.promise):(""!==o.bridgeIP?(o.apiUrl=r(),u=!0,e.resolve()):s().then(function(t){return null!=t[0]?(o.bridgeIP=t[0].internalipaddress,o.apiUrl=r(),u=!0,e.resolve()):(n.error("Error in setup: Returned data from nupnp is empty. Is there a hue bridge present in this network?"),e.reject)},function(t){return n.error("Error in setup: "+t),e.reject}),e.promise)},h=function(r,o,s){var u;return u=t.defer(),e.put(o,s).success(function(e){return f(r,e,u)}).error(function(e){return n.error("Error: "+r,e),u.reject}),u.promise},d=function(r,o,s){var u;return u=t.defer(),e.post(o,s).success(function(e){return f(r,e,u)}).error(function(e){return n.error("Error: "+r,e),u.reject}),u.promise},c=function(r,o){var s;return s=t.defer(),e["delete"](o).success(function(e){return f(r,e,s)}).error(function(e){return n.error("Error: "+r,e),s.reject}),s.promise},l=function(r,o){var s;return s=t.defer(),e.get(o).success(function(e){return f(r,e,s)}).error(function(e){return n.error(""+r,e),s.reject}),s.promise},f=function(e,t,r){return null!=t[0]&&t[0].error?(n.error(""+e,t),r.reject):(n.debug("Response of "+e+":",t),r.resolve(t))},a=function(e){var t,n,r,s;for(null==e&&(e=[]),n=o.apiUrl,r=0,s=e.length;s>r;r++)t=e[r],n+="/"+t;return n},i=function(e,t,r){var o,s;switch(null==t&&(t=[]),null==r&&(r=null),o=e+t.join("/"),s=a(t),e){case"get":return l(o,s);case"post":return d(o,s,r);case"put":return h(o,s,r);case"delete":return c(o,s);default:return n.error("unsupported method "+e)}},s=function(){return l("getBridgeNupnp","https://www.meethue.com/api/nupnp")},r=function(){return"http://"+o.bridgeIP+"/api/"+o.username},this.getBridgeIP=function(){return g().then(function(){return o.bridgeIP})},this.setup=function(e){return null==e&&(e={}),angular.extend(o,e)},this.getLights=function(){return g().then(function(){return i("get",["lights"])})},this.getNewLights=function(){return g().then(function(){return i("get",["lights","new"])})},this.searchNewLights=function(){return g().then(function(){return i("post",["lights"],{})})},this.getLight=function(e){return g().then(function(){return i("get",["lights",e])})},this.setLightName=function(e,t){return g().then(function(){return i("put",["lights",e],{name:t})})},this.setLightState=function(e,t){return g().then(function(){return i("put",["lights",e,"state"],t)})},this.getConfiguration=function(){return g().then(function(){return i("get",["config"])})},this.setConfiguration=function(e){return g().then(function(){return i("put",["config"],e)})},this.createUser=function(e,t){return null==t&&(t=!1),g().then(function(){var n;return n={devicetype:e},t&&(n.username=t),i("post",["api"],n)})},this.deleteUser=function(e){return g().then(function(){return i("delete",["config","whitelist",e])})},this.getFullState=function(){return g().then(function(){return i("get")})},this.getGroups=function(){return g().then(function(){return i("get",["groups"])})},this.createGroup=function(e,t){return g().then(function(){var r;return r={lights:t,name:e},n.debug("Debug: createGroup body",r),i("post",["groups"],r)})},this.getGroupAttributes=function(e){return g().then(function(){return i("get",["groups",e])})},this.setGroupAttributes=function(e,t,n){return g().then(function(){var r;return r={lights:n,name:t},i("put",["groups",e],r)})},this.setGroupState=function(e,t){return g().then(function(){return i("put",["groups",e,"action"],t)})},this.deleteGroup=function(e){return g().then(function(){return i("delete",["groups",e])})},this.getRules=function(){return g().then(function(){return i("get",["rules"])})},this.getRule=function(e){return g().then(function(){return i("get",["rules",e])})},this.createRule=function(e,t,n){return g().then(function(){var r;return r={name:e,conditions:t,actions:n},i("post",["rules"],r)})},this.updateRule=function(e,t,r,o){return null==t&&(t=!1),null==r&&(r=!1),null==o&&(o=!1),g().then(function(){var e;return e={},t&&(e.name=t),r&&(e.conditions=r),o&&(e.actions=o),n.debug("Debug: updateRule body",e),i("put",["rules"],e)})},this.deleteRule=function(e){return g().then(function(){return i("delete",["rules",e])})},this.getSchedules=function(){return g().then(function(){return i("get",["schedules"])})},this.createSchedule=function(e,t,n,r,o,s){return null==e&&(e="schedule"),null==t&&(t=""),null==o&&(o="enabled"),null==s&&(s=!1),g().then(function(){var u;return u={name:e,description:t,command:n,time:r,status:o,autodelete:s},i("post",["schedules"],u)})},this.getScheduleAttributes=function(e){return g().then(function(){return i("get",["schedules",e])})},this.setScheduleAttributes=function(e,t,n,r,o,s,u){return null==t&&(t=null),null==n&&(n=null),null==r&&(r=null),null==o&&(o=null),null==s&&(s=null),null==u&&(u=null),g().then(function(){var o;return o={},t&&(o.name=t),n&&(o.description=n),r&&(o.command=r),s&&(o.status=s),null!==u&&(o.autodelete=u),i("put",["schedules",e],o)})},this.deleteSchedule=function(e){return g().then(function(){return i("delete",["schedules",e])})},this.getScenes=function(){return g().then(function(){return i("get",["scenes"])})},this.createScene=function(e,t,n){return g().then(function(){var r;return r={name:t,lights:n},i("put",["scenes",e],r)})},this.updateScene=function(e,t,n){return g().then(function(){return i("put",["scenes",e,"lights",t,"state"],n)})},this.getSensors=function(){return g().then(function(){return i("get",["sensors"])})},this.createSensor=function(e,t,n,r,o,s,u,a){return null==u&&(u=null),null==a&&(a=null),g().then(function(){var c;return c={name:e,modelid:t,swversion:n,type:r,uniqueid:o,manufacturername:s},u&&(c.state=u),a&&(c.config=a),i("post",["sensors"],c)})},this.searchNewSensors=function(){return g().then(function(){return i("post",["sensors"],null)})},this.getNewSensors=function(){return g().then(function(){return i("get",["sensors","new"])})},this.getSensor=function(e){return g().then(function(){return i("get",["sensors",e])})},this.renameSensor=function(e,t){return g().then(function(){var n;return n={name:t},i("put",["sensors",e],n)})},this.updateSensor=function(e,t){return g().then(function(){return i("put",["sensors",e,"config"],t)})},this.setSensorState=function(e,t){return g().then(function(){return i("put",["sensors",e,"state"],t)})},this.getTimezones=function(){return g().then(function(){return i("get",["info","timezones"])})},this.setEffect=function(e){return function(t,n){return null==n&&(n="none"),e.setLightState(t,{effect:n})}}(this),this.setAlert=function(e){return function(t,n){return null==n&&(n="none"),e.setLightState(t,{alert:n})}}(this),this.setBrightness=function(e){return function(t,n){return e.setLightState(t,{bri:n})}}(this)}]);